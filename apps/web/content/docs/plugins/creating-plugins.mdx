---
title: "Creating Plugins"
description: "Build a custom Corsair plugin for any service — cloud provider, SaaS platform, or internal tool."
section: "plugins"
order: 26
---

## Overview

Corsair uses a plugin-first architecture. The core engine is provider-agnostic — it works with any JSON snapshot. Plugins provide the service-specific logic: how to fetch configuration, what to check for drift, and which attacks to simulate.

## Plugin Structure

```
plugins/
  my-provider/
    my-provider.plugin.json    # Manifest (auto-discovered)
    my-provider-plugin.ts      # TypeScript implementation (optional)
    index.ts                   # Module exports (optional)
```

The only required file is the `.plugin.json` manifest. TypeScript modules are optional but recommended for type safety.

## Step 1: Create the Manifest

Create `plugins/my-provider/my-provider.plugin.json`:

```json
{
  "providerId": "my-provider",
  "providerName": "My Provider",
  "version": "1.0.0",
  "description": "Security testing for My Provider",
  "attackVectors": [
    {
      "id": "weak-auth",
      "name": "Weak Authentication",
      "description": "Tests authentication strength and bypass scenarios",
      "severity": "CRITICAL",
      "mitreMapping": ["T1078"],
      "preconditions": ["Auth is password-only"],
      "remediations": ["Enable MFA", "Enforce strong passwords"]
    }
  ],
  "capabilities": {
    "recon": true,
    "raid": true,
    "escape": true,
    "realTimeAPI": false
  },
  "requiredPermissions": [
    "read:config",
    "read:users"
  ]
}
```

### Required Fields

| Field | Type | Description |
|-------|------|-------------|
| `providerId` | string | Unique identifier (e.g., `aws-cognito`) |
| `providerName` | string | Human-readable name |
| `version` | string | Semantic version |
| `attackVectors` | array | List of attack vector definitions |

### Attack Vector Fields

| Field | Required | Description |
|-------|----------|-------------|
| `id` | Yes | Unique vector ID |
| `name` | Yes | Human-readable name |
| `description` | Yes | What this vector tests |
| `severity` | Yes | CRITICAL, HIGH, MEDIUM, LOW |
| `mitreMapping` | Yes | MITRE ATT&CK technique IDs |
| `preconditions` | No | When this attack applies |
| `remediations` | No | How to fix findings |

## Step 2: Add Framework Mappings

Map your findings to compliance frameworks:

```json
{
  "frameworkMappings": {
    "drift": {
      "authConfig": {
        "mitre": "T1078",
        "mitreName": "Valid Accounts",
        "nist": "IA-2",
        "nistFunction": "Identification and Authentication",
        "soc2": "CC6.1",
        "soc2Description": "Logical access security",
        "description": "Authentication configuration drift"
      }
    },
    "attackVectors": {
      "weak-auth": {
        "mitre": "T1078",
        "nist": "IA-2",
        "soc2": "CC6.1"
      }
    }
  }
}
```

## Step 3: Implement TypeScript Module (Optional)

For type safety and snapshot validation:

```typescript
// plugins/my-provider/my-provider-plugin.ts

export interface MyProviderSnapshot {
  authConfig: {
    mfaEnabled: boolean;
    passwordMinLength: number;
    lockoutThreshold: number;
  };
  users: {
    total: number;
    mfaEnrolled: number;
  };
}

export function isMyProviderSnapshot(data: unknown): data is MyProviderSnapshot {
  if (!data || typeof data !== "object") return false;
  const d = data as Record<string, unknown>;
  return "authConfig" in d && "users" in d;
}

export function createFixtureSnapshot(): MyProviderSnapshot {
  return {
    authConfig: {
      mfaEnabled: false,
      passwordMinLength: 8,
      lockoutThreshold: 5,
    },
    users: {
      total: 500,
      mfaEnrolled: 120,
    },
  };
}
```

## Step 4: Test Discovery

```typescript
import { Corsair } from "corsair/engine";

const corsair = new Corsair();
await corsair.initialize();

console.log(corsair.hasPlugin("my-provider")); // true
console.log(corsair.getPlugin("my-provider").manifest.providerName); // "My Provider"
```

## Step 5: Run a Mission

```bash
# Demo mode (uses fixture data)
bun corsair.ts --target demo --service my-provider

# Live mode (requires real API credentials)
bun corsair.ts --target my-resource-id --service my-provider
```

## Reference Implementations

| Plugin | Complexity | Best For |
|--------|-----------|----------|
| `plugins/aws-cognito/` | Full | Complete reference with all features |
| `plugins/aws-s3/` | Medium | Straightforward config checks |
| `plugins/gitlab/` | Medium | Non-AWS provider example |

## Testing Your Plugin

Write tests in `tests/plugin-system/`:

```typescript
import { describe, test, expect } from "bun:test";
import { Corsair } from "../../src/engine";

describe("My Provider Plugin", () => {
  test("should be discovered", async () => {
    const corsair = new Corsair();
    await corsair.initialize();
    expect(corsair.hasPlugin("my-provider")).toBe(true);
  });

  test("should have valid attack vectors", async () => {
    const corsair = new Corsair();
    await corsair.initialize();
    const plugin = corsair.getPlugin("my-provider");
    expect(plugin.manifest.attackVectors.length).toBeGreaterThan(0);
  });
});
```
