# CORSAIR MVP Atomic Test Suite
# Evaluates the 6 primitives and 4 OpenClaw patterns

name: corsair-mvp-atomic
description: Comprehensive test suite for CORSAIR MVP atomic implementation
version: "1.0.0"

metadata:
  primitives:
    - RECON: Read-only observation of AWS Cognito
    - MARK: Drift detection comparing reality vs expectations
    - RAID: Controlled chaos execution with lane serialization
    - PLUNDER: JSONL evidence extraction with SHA-256 hash chain
    - CHART: MITRE -> NIST -> SOC2 framework mapping
    - ESCAPE: Rollback state with scope guards (RAII pattern)

  patterns:
    - JSONL serialization (append-only, SHA-256 chain)
    - Lane serialization (prevent concurrent raids)
    - Scope guards (RAII cleanup pattern)
    - State machine (7-phase lifecycle)

  fixtures:
    - cognito-userpool-compliant.json
    - cognito-userpool-noncompliant.json
    - cognito-userpool-optional-mfa.json
    - cognito-userpool-weak-password.json
    - cognito-userpool-no-risk-config.json

tasks:
  # RECON Primitive Tests (6 tests)
  - id: recon-01
    name: RECON returns CognitoSnapshot with required fields
    primitive: RECON
    command: bun test tests/primitives/test_recon_readonly.test.ts --filter "returns CognitoSnapshot"
    expect:
      status: pass

  - id: recon-02
    name: RECON captures MFA configuration accurately
    primitive: RECON
    command: bun test tests/primitives/test_recon_readonly.test.ts --filter "MFA configuration"
    expect:
      status: pass

  - id: recon-03
    name: RECON captures password policy details
    primitive: RECON
    command: bun test tests/primitives/test_recon_readonly.test.ts --filter "password policy"
    expect:
      status: pass

  - id: recon-04
    name: RECON captures risk configuration presence
    primitive: RECON
    command: bun test tests/primitives/test_recon_readonly.test.ts --filter "risk configuration"
    expect:
      status: pass

  - id: recon-05
    name: RECON is idempotent
    primitive: RECON
    command: bun test tests/primitives/test_recon_readonly.test.ts --filter "idempotent"
    expect:
      status: pass

  - id: recon-06
    name: RECON tracks observation metadata
    primitive: RECON
    command: bun test tests/primitives/test_recon_readonly.test.ts --filter "metadata"
    expect:
      status: pass

  # MARK Primitive Tests (7 tests)
  - id: mark-01
    name: MARK detects MFA drift when OFF but expected ON
    primitive: MARK
    command: bun test tests/primitives/test_mark_drift.test.ts --filter "MFA drift when OFF"
    expect:
      status: pass

  - id: mark-02
    name: MARK detects OPTIONAL MFA as drift
    primitive: MARK
    command: bun test tests/primitives/test_mark_drift.test.ts --filter "OPTIONAL MFA"
    expect:
      status: pass

  - id: mark-03
    name: MARK detects no drift when compliant
    primitive: MARK
    command: bun test tests/primitives/test_mark_drift.test.ts --filter "no drift when compliant"
    expect:
      status: pass

  - id: mark-04
    name: MARK detects weak password policy drift
    primitive: MARK
    command: bun test tests/primitives/test_mark_drift.test.ts --filter "weak password"
    expect:
      status: pass

  - id: mark-05
    name: MARK detects missing risk configuration
    primitive: MARK
    command: bun test tests/primitives/test_mark_drift.test.ts --filter "missing risk"
    expect:
      status: pass

  - id: mark-06
    name: MARK returns DriftFinding with complete structure
    primitive: MARK
    command: bun test tests/primitives/test_mark_drift.test.ts --filter "complete structure"
    expect:
      status: pass

  - id: mark-07
    name: MARK assigns correct severity levels
    primitive: MARK
    command: bun test tests/primitives/test_mark_drift.test.ts --filter "severity levels"
    expect:
      status: pass

  # RAID Primitive Tests (8 tests)
  - id: raid-01
    name: RAID returns RaidResult with required structure
    primitive: RAID
    command: bun test tests/primitives/test_raid_chaos.test.ts --filter "required structure"
    expect:
      status: pass

  - id: raid-02
    name: RAID simulates MFA bypass on non-compliant pool
    primitive: RAID
    command: bun test tests/primitives/test_raid_chaos.test.ts --filter "MFA bypass on non-compliant"
    expect:
      status: pass

  - id: raid-03
    name: RAID fails MFA bypass on compliant pool
    primitive: RAID
    command: bun test tests/primitives/test_raid_chaos.test.ts --filter "fails MFA bypass on compliant"
    expect:
      status: pass

  - id: raid-04
    name: RAID captures attack timeline
    primitive: RAID
    command: bun test tests/primitives/test_raid_chaos.test.ts --filter "attack timeline"
    expect:
      status: pass

  - id: raid-05
    name: RAID supports multiple attack vectors
    primitive: RAID
    command: bun test tests/primitives/test_raid_chaos.test.ts --filter "multiple attack vectors"
    expect:
      status: pass

  - id: raid-06
    name: RAID enforces lane serialization
    primitive: RAID
    command: bun test tests/primitives/test_raid_chaos.test.ts --filter "lane serialization"
    expect:
      status: pass

  - id: raid-07
    name: RAID respects intensity parameter
    primitive: RAID
    command: bun test tests/primitives/test_raid_chaos.test.ts --filter "intensity parameter"
    expect:
      status: pass

  - id: raid-08
    name: RAID dryRun flag prevents actual changes
    primitive: RAID
    command: bun test tests/primitives/test_raid_chaos.test.ts --filter "dryRun flag"
    expect:
      status: pass

  # PLUNDER Primitive Tests (9 tests)
  - id: plunder-01
    name: PLUNDER creates JSONL formatted output
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "JSONL formatted"
    expect:
      status: pass

  - id: plunder-02
    name: PLUNDER includes SHA-256 hash chain
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "SHA-256 hash chain"
    expect:
      status: pass

  - id: plunder-03
    name: PLUNDER hash is computed correctly
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "hash is computed"
    expect:
      status: pass

  - id: plunder-04
    name: PLUNDER is append-only
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "append-only"
    expect:
      status: pass

  - id: plunder-05
    name: PLUNDER includes sequence numbers
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "sequence numbers"
    expect:
      status: pass

  - id: plunder-06
    name: PLUNDER captures different operation types
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "different operation types"
    expect:
      status: pass

  - id: plunder-07
    name: PLUNDER verifies chain integrity
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "verifies chain"
    expect:
      status: pass

  - id: plunder-08
    name: PLUNDER detects tampered chain
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "tampered chain"
    expect:
      status: pass

  - id: plunder-09
    name: PLUNDER records include ISO timestamps
    primitive: PLUNDER
    command: bun test tests/primitives/test_plunder_evidence.test.ts --filter "ISO timestamps"
    expect:
      status: pass

  # CHART Primitive Tests (10 tests)
  - id: chart-01
    name: CHART maps MFA drift to MITRE ATT&CK
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "MITRE ATT&CK"
    expect:
      status: pass

  - id: chart-02
    name: CHART maps MITRE to NIST CSF
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "NIST CSF"
    expect:
      status: pass

  - id: chart-03
    name: CHART maps NIST to SOC2 CC
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "SOC2 CC"
    expect:
      status: pass

  - id: chart-04
    name: CHART returns ComplianceMapping with chain
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "ComplianceMapping with chain"
    expect:
      status: pass

  - id: chart-05
    name: CHART maps raid results to frameworks
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "raid results to frameworks"
    expect:
      status: pass

  - id: chart-06
    name: CHART includes evidence references
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "evidence references"
    expect:
      status: pass

  - id: chart-07
    name: CHART supports multiple framework output selection
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "framework output selection"
    expect:
      status: pass

  - id: chart-08
    name: CHART maps password policy drift correctly
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "password policy drift"
    expect:
      status: pass

  - id: chart-09
    name: CHART evidenceType is positive for passed controls
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "positive for passed"
    expect:
      status: pass

  - id: chart-10
    name: CHART evidenceType is negative for failed controls
    primitive: CHART
    command: bun test tests/primitives/test_chart_mapping.test.ts --filter "negative for failed"
    expect:
      status: pass

  # ESCAPE Primitive Tests (10 tests)
  - id: escape-01
    name: ESCAPE creates scope guard with initial state
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "scope guard with initial"
    expect:
      status: pass

  - id: escape-02
    name: ESCAPE restores state on scope exit
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "restores state on scope"
    expect:
      status: pass

  - id: escape-03
    name: ESCAPE handles errors with cleanup
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "handles errors"
    expect:
      status: pass

  - id: escape-04
    name: ESCAPE supports nested scope guards
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "nested scope"
    expect:
      status: pass

  - id: escape-05
    name: ESCAPE logs all state transitions
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "state transitions"
    expect:
      status: pass

  - id: escape-06
    name: ESCAPE verifies state restoration
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "verifies state restoration"
    expect:
      status: pass

  - id: escape-07
    name: ESCAPE guard tracks duration
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "tracks duration"
    expect:
      status: pass

  - id: escape-08
    name: ESCAPE provides rollback capability
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "rollback capability"
    expect:
      status: pass

  - id: escape-09
    name: ESCAPE guard timeout expires correctly
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "timeout expires"
    expect:
      status: pass

  - id: escape-10
    name: ESCAPE generates escape report
    primitive: ESCAPE
    command: bun test tests/primitives/test_escape_rollback.test.ts --filter "escape report"
    expect:
      status: pass

summary:
  total_tasks: 50
  primitives_tested: 6
  patterns_tested: 4
  fixtures_used: 5
  expected_pass_rate: "100%"
